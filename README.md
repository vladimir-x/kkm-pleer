**kkm-pleer** программа для воспроизведения музыки на кассовых аппаратах.

Для воспроизведения использует встроенный спикер.

Наданный момент поддерживает кастомный однопоточный формат музыки.

**Доступные KKM**

* mock - программная эмуляция спикера. Для воспроизведения, композиция должна быть длинее секунды
* atol10 - касса атол (пока только linux-x64, x86 и виндовс добавлю позже)

**Запуск**

Для запуска необхадима java 7

* вручную mock-плеер:
    
    java -jar kkm-pleer-1.0-SNAPSHOT.jar -f music/some.txt
    java -jar kkm-pleer-1.0-SNAPSHOT.jar -f music/some.txt -kkm mock
    
* вручную atol-плеер:
    
    java -Djava.library.path=lib/native/linux-64 -jar kkm-pleer-1.0-SNAPSHOT.jar -f music/some.txt -kkm atol10 -ip 172.29.1.116:5555

* скрипты для linux: 
    
    mock-play.sh                     
    atol-play.sh

Ключи запуска:
* -Djava.library.path=lib/native/linux-64 - путь для нативной библиотеки, для работы с ккм
* -f music/some.txt - путь до файла с музыкой
* -kkm atol10 - указание типа кассы. По умолчанию mock
* -v -10 (-v 25)  - громкость (если поддерживается кассой). По умолчанию -30.
* -ip 172.29.1.116:5555 - подключение по ip:port
* -com com1:9600 (/dev/ttyXXX0) - подключение по com-порту 

**Сборка**

Сборка осуществляется maven-ом.
maven-build.sh - устанавливает jar  для касс в локальный репозиторийи выполняет clean package для проекта
Собранный плеер копируется в папку build
  
**Библиотека музыки:** https://wiki.taucetistation.org/Music

**Пример музыкального файла**

    BPM: 167
    G3, ,G,G/3,G/3,G/3,G,G,Eb3/2,E/2,E
    G3, ,G,G/3,G/3,G/3,G,G,Eb3/2,E/2,E

**Описание формата:**

* BPM -  beats per minute, удары в минуту
* C,D,E,F,G,A,B = до ре ми фа соль ля си, 
* Октавы от 0 до 10 
* A4 = 440Гц = Ля первой октавы , A5 - Ля второй октавы , G3 - соль малой октавы и тд.
* , , - пауза , \n (пеернос строки) - интерпретируется как пауза ( для совместимости с библиотекой музыки от проекта taucetistation)
* A# - ля-диез, Ab - ля-бемоль , An - ля-бекар
* A без номера октавы - предыдущая указанная у Ля октава

Пример: Ab3,A,An3,A,A#3,A,An3 - два удара по ля-бемоль, два по ля, два по ля-диез, и опять по обычной ля.

* An4-Cn5-En5 - одновременная игра (сейчас не поддерживается, и будет воспроизведена последняя нота En5)
* /2 , изменение длительности. 
  A4/2 - в два раза медленнее от заданного bpm, A4/0.5 - в 2 раза быстрее


**Планы на будущее**
Будущего нет, это простой фановый проект. Однако, хотелось бы:
* больше типов касс
* поддержка формата midi
* моногоканальный звук (оркестр касс, лол)

**Идея:** Дмитрий Бачило (https://youtu.be/xBWnS7BH9JQ?t=9974)
